typeCheckSource sourceType fors@(ForSource{fsTy, collection}) = do
    collectionTyped <- doTypecheck collection
    let collectionType = AST.getType collectionTyped
    formalType <- findFormalRefType collectionType
    let mtyType = return $ getInnerType collectionType
    unless (formalType == sourceType) $
      pushError collection $ TypeMismatchError formalType sourceType
    return fors{fsTy = mtyType
               ,collection = setType collectionType collectionTyped}

firstSourceType ForSource{fsTy, collection} = do
    collectionTyped <- doTypecheck collection
    let collectionType = AST.getType collectionTyped
    formal <- findFormalRefType collectionType
    return formal
